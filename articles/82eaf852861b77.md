---
title: "Hono + OpenAPI + Orvalã‚’ä½¿ã£ãŸå‹å®‰å…¨ãªé–‹ç™º"
emoji: "ğŸ„"
type: "tech"
topics: ["hono", "typescript", "orval", "valibot", "openapi"]
published: false
publication_name: ambr_inc
---

## ã¯ã˜ã‚ã«

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®APIã‚’å¤‰æ›´ã—ãŸã‚‰ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŠœã‘æ¼ã‚Œã‚„å‹ãŒç•°ãªã‚‹ã“ã¨ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
ãã‚“ãªé–‹ç™ºä½“é¨“ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€Hono + OpenAPI + Orvalã®æ§‹æˆã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å®šç¾©ã—ãŸAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹ã‚’å…±æœ‰ã§ãã‚‹Hono RPCã‚‚ã‚ã‚Šã¾ã™ãŒã€`useQuery`ã‚„`useMutation`ã‚’è¿½åŠ ã§ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã€ãã“ã‚’è² æ‹…ã—ã¦ãã‚Œã‚‹Orvalã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚

ä»Šå›ã¯ã€ãƒŸãƒ‹ãƒãƒ«ãªã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒªã‚’ä¾‹ã«ä½œã£ã¦ã¿ã¾ã™ã€‚

ãƒªãƒã‚¸ãƒˆãƒª:
https://github.com/Takashicc/todo-app-hono

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

ä»¥ä¸‹ã®æµã‚Œã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã«å…±æœ‰ã—ã¾ã™ã€‚

```mermaid
flowchart TB
  backend["backend(Hono + OpenAPI)"] -- "OpenAPI Specç”Ÿæˆ" --> openapi["openapi.json"]
  openapi -- "Orvalã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ" --> packages-api["@packages/api"]
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

honoã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
CloudflareãŒæä¾›ã—ã¦ã„ã‚‹ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ã£ã¦ä½œæˆã—ã¾ã™ã€‚

https://developers.cloudflare.com/workers/framework-guides/web-apps/more-web-frameworks/hono/

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã¯`pnpm`ã‚’ä½¿ã„ã¾ã™ã€‚

```sh
pnpm create cloudflare@latest todo-app-hono --template=cloudflare/templates/vite-react-template
```

ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒä½œæˆã•ã‚Œã€`src`ãƒ•ã‚©ãƒ«ãƒ€é…ä¸‹ã«ã‚ã‚‹`react-app`ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã€`worker`ãŒãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãªã‚Šã¾ã™ã€‚

```sh
.
â”œâ”€â”€ eslint.config.js
â”œâ”€â”€ index.html
â”œâ”€â”€ node_modules
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ public
â”‚   â””â”€â”€ vite.svg
â”œâ”€â”€ README.md
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ react-app
â”‚   â””â”€â”€ worker
â”œâ”€â”€ tsconfig.app.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.node.json
â”œâ”€â”€ tsconfig.worker.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ worker-configuration.d.ts
â””â”€â”€ wrangler.json
```

å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚

```sh
pnpm add valibot hono-openapi @valibot/to-json-schema @hono/swagger-ui tsx
pnpm add --save-dev orval
```

ã¾ãŸã€ã“ã‚Œã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§`/api/...`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Ÿè£…ã—ã¦ã„ãã®ã§ã™ãŒã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¾ã¾ã ã¨`/api/...`ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ãŸæ™‚ã«ã‚¢ã‚»ãƒƒãƒˆãŒå„ªå…ˆã•ã‚Œã¦WorkerãŒå®Ÿè¡Œã•ã‚Œãªã„ãŸã‚ã€ã“ã®æŒ™å‹•ã‚’å¤‰æ›´ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
`wrangler.json`ã«`assets.run_worker_first`è¨­å®šã‚’è¿½è¨˜ã™ã‚‹ã“ã¨ã§ã€`/api/...`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæŠ•ã’ã‚‰ã‚ŒãŸã‚‰ã€Workerã‚’å„ªå…ˆã—ã¦å®Ÿè¡Œã•ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff
{
  "$schema": "node_modules/wrangler/config-schema.json",
  "name": "todo-app-hono",
  "main": "./src/worker/index.ts",
  "compatibility_date": "2025-10-08",
  "compatibility_flags": ["nodejs_compat"],
  "observability": {
    "enabled": true
  },
  "upload_source_maps": true,
  "assets": {
    "directory": "./dist/client",
    "not_found_handling": "single-page-application",
+    "run_worker_first": ["/api/*"]
  }
}
```

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…

Todoã‚’æ“ä½œã™ã‚‹APIã‚’å®šç¾©ã—ã¾ã™ã€‚
å…¨é‡è¼‰ã›ã‚‹ã¨ã‚³ãƒ¼ãƒ‰ãŒé•·ããªã‚‹ã®ã§ã€IDæŒ‡å®šå–å¾—ã¨ä½œæˆã™ã‚‹APIã®ã¿ã‚’ä¾‹ã«å‡ºã—ã¾ã™ã€‚

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹å®šç¾©

ã¾ãšã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹å®šç¾©ã‚’Valibotã‚’ä½¿ã£ã¦è¡Œã„ã¾ã™ã€‚

```ts:src/worker/index.ts
import * as v from "valibot";

const todoSchema = v.object({
	id: v.string(),
	title: v.string(),
	completed: v.boolean(),
});
type Todo = v.InferOutput<typeof todoSchema>;

const todoIdSchema = v.pipe(v.string(), v.uuid());
const todoTitleSchema = v.pipe(v.string(), v.nonEmpty());

// GET /api/todos/:id
const getTodoParamSchema = v.object({
  id: todoIdSchema,
});
const getTodoResponseSchema = v.object({
  todo: todoSchema,
});
type GetTodoResponse = v.InferOutput<typeof getTodoResponseSchema>;

// POST /api/todos
const createTodoRequestSchema = v.object({
	title: todoTitleSchema,
});
const createTodoResponseSchema = todoSchema;
type CreateTodoResponse = v.InferOutput<typeof createTodoResponseSchema>;
```

#### Todoã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ»ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹å®šç¾©ã‚’ä½¿ã£ã¦ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’çµ„ã¿ç«‹ã¦ã¾ã™ã€‚

`hono-openapi`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦OpenAPIå®šç¾©ã‚’æ›¸ãã¾ã™ã€‚
ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã¯`Valibot`ã¨ä¸€ç·’ã«ä½¿ã†ä¾‹ã‚’è¼‰ã›ãŸå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

https://honohub.dev/docs/openapi/valibot

`describeRoute`é–¢æ•°ã‚’ä½¿ã£ã¦ã€OpenAPI Specã‚’å®šç¾©ã—ã¾ã™ã€‚

:::message
`describeResponse`ã¨ã„ã†é–¢æ•°ã‚‚ã‚ã‚Šã€

https://honohub.dev/docs/openapi/valibot#adding-typesense-for-response-body

ã“ã‚Œã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¨ãƒœãƒ‡ã‚£ã‚’å®šç¾©ã™ã‚‹ã“ã¨ã§ã€å®Ÿéš›ã®å‡¦ç†ã§è¿”å´ã™ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ã‚’å¼·åˆ¶ã•ã›ã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚
`describeRoute`ã¨ä¸€ç·’ã«ä½¿ãˆã¾ã™ãŒã€`c.req.valid()`ãŒå‹ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã£ã¦ä»Šã®ã¨ã“ã‚ä½¿ãˆãªã„ã®ã§ã€`describeRoute`ã ã‘ã‚’ä½¿ã„ã¾ã™ã€‚

https://github.com/rhinobase/hono-openapi/issues/145
:::

è‡ªåˆ†ãŒå°‘ã—ãƒãƒã£ãŸç‚¹ã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯`hono-openapi`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ãŸ`validator`ã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€ä¼¼ãŸã‚ˆã†ãªåå‰ã§`@hono/standard-validator`ã‹ã‚‰ã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã‚‹`sValidator`ã‚’ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã ã€ã“ã‚Œã‚’ä½¿ã£ãŸå ´åˆã«OpenAPIå®šç¾©ã‹ã‚‰ã”ã£ãã‚Šãã®éƒ¨åˆ†ãŒãªããªã£ã¦ã—ã¾ã†ã®ã§ã€`hono-openapi`ã«ã‚ã‚‹`validator`ã‚’ä½¿ã†ã‚ˆã†æ³¨æ„ã—ã¾ã—ã‚‡ã†ã€‚

```ts:src/worker/index.ts
import { Hono } from "hono";
import {
  describeRoute,
  resolver,
  validator,
} from "hono-openapi";
import * as v from "valibot";

const todos: Todo[] = [];

const app = new Hono<{ Bindings: Env }>()
  .basePath("/api")
  .get(
    "/todos/:id",
    validator("param", getTodoParamSchema),
    describeRoute({
      description: "Get a todo by id",
      responses: {
        200: {
          description: "Success",
          content: {
            "application/json": {
              schema: resolver(getTodoResponseSchema),
            },
          },
        },
        404: {
          description: "Todo not found",
          content: {
            "application/json": {
              schema: resolver(errorResponseSchema),
            },
          },
        },
      },
    }),
    (c) => {
      const { id } = c.req.valid("param");
      const todo = todos.find((todo) => todo.id === id);
      if (!todo) {
        return c.json<ErrorResponse>({ error: "Todo not found" }, 404);
      }
      return c.json<GetTodoResponse>({ todo });
    },
  )
  .post(
    "/todos",
    validator("json", createTodoRequestSchema),
    describeRoute({
      description: "Create a todo",
      responses: {
        200: {
          description: "Success",
          content: {
            "application/json": {
              schema: resolver(createTodoResponseSchema),
            },
          },
        },
      },
    }),
    (c) => {
      const { title } = c.req.valid("json");
      const id = crypto.randomUUID();
      const todo = { id, title, completed: false };
      todos.push(todo);
      return c.json<CreateTodoResponse>(todo);
    },
  );

export default app;
```

#### OpenAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

OpenAPIã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã§ãã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¨ã€SwaggerUIã‚’ç¢ºèªã§ãã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç”¨æ„ã—ã¾ã™ã€‚
ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã¾ã¾ã ã¨OpenAPIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚‚OpenAPIã®JSONã«å«ã¾ã‚Œã‚‹ãŸã‚ã€`exclude`ã‚’ä½¿ã£ã¦é™¤å¤–ã—ã¾ã™ã€‚

```ts:src/worker/index.ts
import { swaggerUI } from "@hono/swagger-ui";
import { GenerateSpecOptions, openAPIRouteHandler } from "hono-openapi";

export const openAPISpecOptions: Partial<GenerateSpecOptions> = {
  documentation: {
    info: {
      title: "Todo API",
      version: "1.0.0",
    },
  },
  includeEmptyPaths: true,
  exclude: ["/api/openapi.json", "/api/openapi/swagger-ui"],
};

app
  .get("/openapi.json", openAPIRouteHandler(app, openAPISpecOptions))
  .get("/openapi/swagger-ui", swaggerUI({ url: "/api/openapi.json" }));
```

ã“ã‚Œã§`pnpm run dev`ã‚’å®Ÿè¡Œã—ã¦ã€`http://localhost:5173/api/openapi/swagger-ui`ã«è¡Œãã“ã¨ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ãªç”»é¢ãŒç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](/images/82eaf852861b77/swagger-ui.png)

#### OpenAPIãƒ•ã‚¡ã‚¤ãƒ«ã®ç”Ÿæˆ

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å®šç¾©ã—ãŸOpenAPI Specã‹ã‚‰OpenAPIãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç”¨æ„ã—ã¾ã™ã€‚

https://honohub.dev/docs/openapi/persisting

```ts:src/worker/scripts/generate-openapi-specs.ts
import { generateSpecs } from "hono-openapi";
import fs from "node:fs";
import app, { openAPISpecOptions } from "..";

async function main() {
  const specs = await generateSpecs(app, openAPISpecOptions);
  fs.writeFileSync("./openapi.json", JSON.stringify(specs));
}

main();
```

ã“ã®ã¾ã¾ã ã¨`Cannot find module 'node:fs' or its corresponding type declarations`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
ã“ã‚Œã¯ã€ä¸Šè¨˜ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§`node:fs`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ã„ã¾ã™ãŒã€å‹å®šç¾©ãŒè¦‹ã¤ã‹ã‚‰ãšã€å‹ãƒã‚§ãƒƒã‚¯ã‚„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è§£æ±ºãŒã§ããªã„ãŸã‚ç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚ˆã†ã«`tsconfig.worker.json`ã§Node.jsã®å‹å®šç¾©ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```diff:tsconfig.worker.json
{
  "extends": "./tsconfig.node.json",
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.worker.tsbuildinfo",
-    "types": ["vite/client", "./worker-configuration.d.ts"]
+    "types": ["vite/client", "./worker-configuration.d.ts", "node"]
  },
  "include": ["src/worker"]
}
```

`package.json`ã«ç”¨æ„ã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã‚³ãƒãƒ³ãƒ‰ã‚’è¨­å®šã—ã¾ã™ã€‚

```diff:package.json
{
  "scripts": {
+    "generate": "tsx ./src/worker/scripts/generate-openapi-spec.ts",
  },
}
```

`pnpm run generate`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`openapi.json`ãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

### APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ç”Ÿæˆ

ç”Ÿæˆã•ã‚ŒãŸOpenAPIãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰Orvalã‚’ä½¿ã£ã¦TanStack Queryã‚’ä½¿ã£ãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç”Ÿæˆã—ã¾ã™ã€‚
ã¾ãšã€`packages/api`ã«ç”Ÿæˆã—ãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ç½®ããŸã‚ã€pnpm workspaceã‚’è¨­å®šã—ã¾ã™ã€‚

https://pnpm.io/ja/workspaces

https://pnpm.io/ja/catalogs

`catalog`ã«ã¯å…±é€šã—ã¦ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›¸ãã¾ã™ã€‚tsdownã¯ãƒ“ãƒ«ãƒ‰ã«ä½¿ã„ã¾ã™ã€‚

```yaml:pnpm-workspace.yaml
packages:
  - packages/*

catalog:
  "@tanstack/react-query": ^5.90.9
  tsdown: ^0.15.12
  typescript: 5.8.3
```

`packages/api`ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã„ã¾ã™ã€‚

```json:packages/api/package.json
{
  "name": "@packages/api",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "orval --config ./orval.config.ts && tsdown --config ./tsdown.config.ts",
    "watch": "tsdown --watch --config ./tsdown.config.ts",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@tanstack/react-query": "catalog:",
    "axios": "^1.13.2"
  },
  "devDependencies": {
    "tsdown": "catalog:",
    "typescript": "catalog:"
  }
}
```

Orvalã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã«ç”Ÿæˆã•ã‚ŒãŸ`openapi.json`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…ƒã«TanStack Queryã€axiosã‚’ä½¿ã£ãŸAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚

https://orval.dev/guides/react-query

ã¾ãŸã€`useSuspenseQuery`ãŒä½¿ã„ãŸã„å ´åˆã¯ã€`override.query`è¨­å®šã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ç”Ÿæˆã§ãã¾ã™ã€‚

https://zenn.dev/galapagos/articles/86666ca2d3805e

```ts:packages/api/orval.config.ts
import { defineConfig } from "orval";

export default defineConfig({
  "todo-app-api": {
    input: "../../openapi.json",
    output: {
      target: "./src/index.ts",
      client: "react-query",
      biome: true,
      override: {
        query: {
          useSuspenseQuery: true,
          version: 5,
        },
      },
    },
  },
});
```

`tsconfig.json`ã‚’ç”¨æ„ã—ã¾ã™ã€‚

```ts:packages/api/tsconfig.json
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "declaration": true,
    "declarationMap": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "noUncheckedSideEffectImports": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "paths": {
      "@/*": ["./src/*"]
    },
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "**/*.test.ts", "**/*.spec.ts"]
}
```

tsdownã‚’ä½¿ã£ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ãŸã‚ã€`tsdown.config.ts`è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚

https://tsdown.dev/reference/api/Interface.UserConfig

```ts:packages/api/tsdown.config.ts
import { defineConfig } from "tsdown";

export default defineConfig({
  entry: ["./src/index.ts"],
  dts: {
    sourcemap: true,
  },
  target: false,
  platform: "browser",
  minify: true,
  exports: true,
});
```

:::message
experimentalãªæ©Ÿèƒ½ã§ã‚ã‚‹`exports: true`ã«ã¤ã„ã¦ã€`package.json`ã«ã‚‚exportè¨­å®šãŒå¿…è¦ã§ã™ãŒã€`exports: true`ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€exportè¨­å®šã‚’tsdownã§ãƒ“ãƒ«ãƒ‰æ™‚ã«`package.json`ã¸è‡ªå‹•çš„ã«åæ˜ ã§ãã¾ã™ã€‚

`packages/api`ã§`pnpm run build`ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«è¨­å®šãŒè¿½è¨˜ã•ã‚Œã¾ã™ã€‚

```diff:packages/api/package.json
{
  "name": "@packages/api",
  "private": true,
  "type": "module",
  "scripts": {
    "build": "orval --config ./orval.config.ts && tsdown --config ./tsdown.config.ts",
    "watch": "tsdown --watch --config ./tsdown.config.ts",
    "typecheck": "tsc --noEmit"
  },
  "dependencies": {
    "@tanstack/react-query": "catalog:",
    "axios": "^1.13.2"
  },
  "devDependencies": {
    "tsdown": "catalog:",
    "typescript": "catalog:"
  },
+  "main": "./dist/index.js",
+  "module": "./dist/index.js",
+  "types": "./dist/index.d.ts",
+  "exports": {
+    ".": "./dist/index.js",
+    "./package.json": "./package.json"
+  }
}
```

:::

æœ€å¾Œã«ç©ºã®`src/index.ts`ã‚’ç”¨æ„ã—ã¦ã€`cd packages/api`ã€`pnpm run build`ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å®Ÿè£…

ã¾ãšã€`package.json`ã«`@packages/api`ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff:package.json
  "dependencies": {
+    "@packages/api": "workspace:*"
  },
```

tailwindcssã‚„TanStack Queryãªã©ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚‚ã‚ã‚Šã¾ã™ãŒã€å°ºãŒé•·ããªã‚‹ã®ã§çœç•¥ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®ã‚³ãƒŸãƒƒãƒˆã‹ã‚‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

https://github.com/Takashicc/todo-app-hono/commit/ecc975d892c479efdb7af559953e92981e8194e3

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸå¾Œã€`@packages/api`ã‹ã‚‰`useXXX`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚
ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹ãŒã¡ã‚ƒã‚“ã¨å®šç¾©ã•ã‚Œã¦ãŠã‚Šã€è£œå®ŒãŒåŠ¹ãã»ã‹ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«å¤‰åŒ–ãŒã‚ã£ãŸå ´åˆã¯APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã€ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æŠœã‘æ¼ã‚Œã‚„å‹é•ã„ã®åŒæœŸãšã‚Œã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚

```ts:src/react-app/App.tsx
import {
  getGetApiTodosQueryKey,
  useGetApiTodosSuspense,
  usePostApiTodos,
  usePutApiTodosId,
} from "@packages/api";
import { useQueryClient } from "@tanstack/react-query";
import { useState } from "react";

function App() {
  const queryClient = useQueryClient();
  const [title, setTitle] = useState("");

  const todosQuery = useGetApiTodosSuspense();
  const todos = todosQuery.data.data.todos;
  const completedCount = todos.filter((t) => t.completed).length;

  const createTodoMutation = usePostApiTodos({
    mutation: {
      onSuccess: () => {
        queryClient.invalidateQueries({ queryKey: getGetApiTodosQueryKey() });
      },
    },
  });

  const updateTodoMutation = usePutApiTodosId({
    mutation: {
      onSuccess: () => {
        queryClient.invalidateQueries({ queryKey: getGetApiTodosQueryKey() });
      },
    },
  });

  return ...;
}
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç”»é¢ã®å®Ÿè£…å¾Œã€`pnpm run dev`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰ç”»é¢ã‚’ç¢ºèªã§ãã¾ã™ã€‚

![](/images/82eaf852861b77/todo-app-preview.png)

## ãŠã‚ã‚Šã«

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å°‘ã—æ™‚é–“ã¯ã‹ã‹ã‚Šã¾ã™ãŒã€ã“ã®æ§‹æˆã‚’ä½¿ã†ã“ã¨ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®APIé½Ÿé½¬ã‚’å°‘ãªãã§ãã€ãƒŸã‚¹ã®å°‘ãªã„å®‰å…¨ãªé–‹ç™ºãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ç‰¹ã«ã€ãƒãƒ¼ãƒ é–‹ç™ºã«ãŠã„ã¦ã¯APIã®å¤‰æ›´ã«ã‚ˆã‚‹å½±éŸ¿ç¯„å›²ã‚’äº‹å‰ã«æŠŠæ¡ã§ãã€ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚„APIè¨­è¨ˆã®å¤‰æ›´ã‚‚å®‰å¿ƒã—ã¦è¡Œãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¾ãŸã€OpenAPIä»•æ§˜æ›¸ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®è² æ‹…ã‚‚è»½æ¸›ã•ã‚Œã¾ã™ã€‚

ãœã²å‹å®‰å…¨ãªé–‹ç™ºä½“é¨“ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚
