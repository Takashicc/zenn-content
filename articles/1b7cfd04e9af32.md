---
title: "ambrã®æŠ€è¡“è¨˜äº‹ã‚’æ”¯ãˆã‚‹æŠ€è¡“"
emoji: "ğŸ”–"
type: "tech"
topics: ["zenn", "githubactions", "github", "taskfile"]
published: false
publication_name: ambr_inc
---
<!-- cSpell:disable -->
## ã¯ã˜ã‚ã«

:::message
ã“ã®è¨˜äº‹ã¯[ambr, Inc. Advent Calendar 2025](https://adventar.org/calendars/11923)ã®12/25ã®è¨˜äº‹ã§ã™ã€‚
æ˜¨æ—¥ã¯[@qazx7412](https://zenn.dev/qazx7412)ã•ã‚“ã®[ãƒ¢ãƒã‚¤ãƒ«ç‰ˆGoghãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’æŒ¯ã‚Šè¿”ã‚‹](https://zenn.dev/ambr_inc/articles/3ea67a78d7c5c4)ã§ã—ãŸã€‚
:::

ã“ã‚“ã«ã¡ã¯ã€ambrã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã‚’ã‚„ã£ã¦ã„ã‚‹Takashiccã§ã™ã€‚

1å¹´ã»ã©å‰ã®2024å¹´11æœˆã¾ã§ã€ambrã§ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã‚’ä½¿ã£ã¦ã„ã¾ã—ãŸã€‚
ã§ã™ãŒã€è‰²ã€…ãªç†ç”±ã¨ã¨ã‚‚ã«æ˜¨å¹´ã®2024/12/01ã‚’æœŸã«ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã®ç’°å¢ƒã‚’ä¸€æ–°ã—ã€ã¯ã¦ãªãƒ–ãƒ­ã‚°ã‹ã‚‰Zennã«ç§»è¡Œã—ã¾ã—ãŸã€‚

ç§»è¡Œã®èƒŒæ™¯ã«ã¤ã„ã¦ã¯ã‚µãƒƒã‚¯ãƒ¼ã•ã‚“ã®è¨˜äº‹ã‚’å‚ç…§ãã ã•ã„ã€‚

https://zenn.dev/ambr_inc/articles/d39be935a5cd20

ãã‚Œã«ä¼´ã„ã€ä»Šã¾ã§ã¯ã¯ã¦ãªãƒ–ãƒ­ã‚°ã®Webã‚¨ãƒ‡ã‚£ã‚¿ä¸Šã§è¨˜äº‹ã‚’å„ã€…ãŒæ›¸ã„ã¦ã„ãã¨ã„ã†æ–¹å¼ã‚’ã¨ã£ã¦ã„ã¾ã—ãŸãŒã€ã“ã‚Œã‚’Zennã¨GitHubã‚’é€£æºã™ã‚‹å½¢ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã‚’æ›¸ãä¸»ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ã‚ã‚‹é–‹ç™ºè€…ã«ã¨ã£ã¦ã‚„ã‚Šã‚„ã™ã„ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚

æ§‹ç¯‰ã—ã¦ã‹ã‚‰æ—©1å¹´ã»ã©ãŒçµŒã¡ã€ã“ã®1å¹´ã§30ä»¶ä»¥ä¸Šã®è¨˜äº‹ã‚’å…¬é–‹ã—ã€å¤§ããªãƒˆãƒ©ãƒ–ãƒ«ãªãé‹ç”¨ã§ãã¾ã—ãŸã€‚ã“ã“ã‚‰ã§ã©ã®ã‚ˆã†ãªåŸ·ç­†ç’°å¢ƒã«ãªã£ãŸã‹ã‚’è§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

## Publicationã¨GitHubé€£æº

Zennã§ã¯GitHubã§ã„ã†Organizationã®ã‚ˆã†ãªæ©Ÿèƒ½ã¨ã—ã¦ã€Zenn Publicationã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚
Zenn Publicationã§ã¯ãƒ—ãƒ©ãƒ³ãŒFreeã¨Proã®2ã¤ãŒã‚ã‚Šã€Proã ã¨çµ±è¨ˆæ©Ÿèƒ½ã‚„PRãƒãƒŠãƒ¼ã€GitHubé€£æºãªã©ä¼šç¤¾ã«ã¨ã£ã¦æœ‰ç›Šãªæ©Ÿèƒ½ãŒè±Šå¯Œãªã®ã§ã™ãŒã€æˆ‘ã€…ambrã§ã¯Publication Freeãªã®ã§å…¬å¼ãŒæä¾›ã—ã¦ã„ã‚‹GitHubé€£æºãŒä½¿ãˆã¾ã›ã‚“ã€‚ã¾ãŸã€æ§‹ç¯‰å½“æ™‚ã¯ã¾ã Publication Proã§ã‚‚GitHubé€£æºãŒã¾ã æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã§ã—ãŸã€‚

ãã®ãŸã‚ç‹¬è‡ªã«æŠ€è¡“è¨˜äº‹ã‚’ç®¡ç†ã§ãã‚‹ä»•çµ„ã¿ãŒå¿…è¦ã§ã—ãŸã€‚

åŸ·ç­†è€…å„è‡ªãŒå€‹äººãƒªãƒã‚¸ãƒˆãƒªã§è¨˜äº‹ã‚’ç®¡ç†ã—ã¦ã„ãã¨ã„ã†ã‚„ã‚Šæ–¹ã‚‚ã‚ã‚Šã¾ã—ãŸãŒã€ä¼šç¤¾ã¨ã—ã¦å‡ºã™è¨˜äº‹ã§ã‚‚ã‚ã‚‹ã®ã§ä¸€å…ƒç®¡ç†ã—ãŸã‹ã£ãŸã®ã¨ã€Lintã‚„ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä¼šç¤¾ãƒªãƒã‚¸ãƒˆãƒªå˜ä½“ã§ã‚„ã£ãŸæ–¹ãŒã‚„ã‚Šã‚„ã™ãã†ã ã£ãŸã®ã§ã€ambrã®GitHub Organizationã«ambrã®è¨˜äº‹ã‚’ç®¡ç†ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’æ§‹ãˆã¦ã€GitHub Actionsã‚’ä½¿ã£ã¦å„åŸ·ç­†è€…å€‹äººå€‹äººã®ãƒªãƒã‚¸ãƒˆãƒªã«åæ˜ ã—ã¦ã„ãã¨ã„ã†ã‚„ã‚Šæ–¹ãŒè‰¯ã•ãã†ã ã¨ã„ã†ã“ã¨ã§ã€æ—©é€Ÿç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã—ãŸã€‚

## è¨˜äº‹åŸ·ç­†ãƒ•ãƒ­ãƒ¼

ã–ã£ãã‚Šã¨ã—ãŸè¨˜äº‹åŸ·ç­†ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚

```mermaid
sequenceDiagram
  autonumber
  actor Author as è¨˜äº‹åŸ·ç­†è€…
  actor Owner as ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼
  participant AmbrRepo as ambr-zenn-contentsï¼ˆGitHubï¼‰
  participant GA as GitHub Actions
  participant AuthorRepo as åŸ·ç­†è€…ã®zenn-contentsï¼ˆGitHubï¼‰
  participant Zenn as Zenn

  Author->>AmbrRepo: è¨˜äº‹è¿½åŠ /æ›´æ–°ã®PRã‚’ä½œæˆ
  Owner->>AmbrRepo: PRã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ãƒãƒ¼ã‚¸
  AmbrRepo-->>GA: pull_request closedã‚’ãƒˆãƒªã‚¬ãƒ¼
  GA->>AuthorRepo: è¨˜äº‹å†…å®¹ã‚’åæ˜ ã—ãŸPRã‚’è‡ªå‹•ä½œæˆ
  Author->>AuthorRepo: PRã‚’ãƒãƒ¼ã‚¸
  AuthorRepo->>Zenn: Zennã§è¨˜äº‹ãŒãƒ‰ãƒ©ãƒ•ãƒˆçŠ¶æ…‹ã§å…¬é–‹ã•ã‚Œã‚‹
  Author->>AmbrRepo: è¨˜äº‹ã®å…¬é–‹ãƒ•ãƒ©ã‚°(published)ã‚’trueã«ã™ã‚‹PRã‚’ä½œæˆ
  AmbrRepo-->>GA: pull_request closedã‚’ãƒˆãƒªã‚¬ãƒ¼
  GA->>AuthorRepo: è¨˜äº‹å†…å®¹ã‚’åæ˜ ã—ãŸPRã‚’è‡ªå‹•ä½œæˆ
  Author->>AuthorRepo: å…¬é–‹ã—ãŸã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§PRã‚’ãƒãƒ¼ã‚¸
  AuthorRepo->>Zenn: Zennã§è¨˜äº‹ãŒå…¬é–‹ã•ã‚Œã‚‹
```

## ç’°å¢ƒæ§‹ç¯‰

ç’°å¢ƒã‚’ç”¨æ„ã™ã‚‹ãŸã‚ã«ã¯ã€åŸ·ç­†è€…ã®ãƒªãƒã‚¸ãƒˆãƒªã¸æ›¸ã„ãŸè¨˜äº‹ã‚’åæ˜ ã™ã‚‹PRã‚’ä½œæˆã™ã‚‹ãŸã‚ã®GitHub Appsã®ä½œæˆã¨ã€è¨˜äº‹ã‚’ç®¡ç†ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### GitHub Apps

GitHub Actionãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹éš›ã«ç™ºè¡Œã•ã‚Œã‚‹æ¨©é™ã¯ã€åŸºæœ¬çš„ã«ãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã«ã—ã‹ã‚¢ã‚¯ã‚»ã‚¹ã§ããšã€åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªãŒPublicã§ã‚ã‚Œã°ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ãŒã€Privateã®å ´åˆã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
ã“ã“ã§GitHub Appsã‚’ä½¿ã†ã“ã¨ã§å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰GitHub Appsã‚’ä½œæˆã§ãã¾ã™ã€‚`<org_name>`ã‚’è‡ªåˆ†ãŒæ‰€å±ã—ã¦ã„ã‚‹çµ„ç¹”ã®åå‰ã«ç½®ãæ›ãˆã¦ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚
`https://github.com/organizations/<org_name>/settings/apps/new`

Webhookã¯ä½¿ã‚ãªã„ã®ã§ç„¡åŠ¹åŒ–ã—ã€ä»–ã®å¿…é ˆé …ç›®ã‚’è¨­å®šã—ã¾ã™ã€‚

å¿…é ˆé …ç›®ã‚’è¨­å®šã—ãŸã‚‰ã€`Repository permissions`ã‚’é–‹ãã€`Contents`ã¨`Pull requests`ã‚’`Access: Read and write`ã«å¤‰æ›´ã—ã¾ã™ã€‚

![](/images/1b7cfd04e9af32/github-apps-contents-permission.png)
![](/images/1b7cfd04e9af32/github-apps-pull-requests-permission.png)

ã¾ãŸã€ã“ã®GitHub Appsã‚’åŸ·ç­†è€…ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚‹ã®ã§ã€`Where can this GitHub App be installed?`ã®ã¨ã“ã‚ã‚’`Any account`ã«ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

![](/images/1b7cfd04e9af32/github-apps-where-to-install.png)

ä½œæˆã—ãŸã‚‰ã€ä½œæˆã—ãŸGitHub Appsã®è©³ç´°ãƒšãƒ¼ã‚¸ã§`App ID`ã‚’æ§ãˆã¦ã€`Private keys`ã¨ã„ã†ã¨ã“ã‚ã§`Generate a private key`ã‚’æŠ¼ä¸‹ã—ã¦ç§˜å¯†éµã‚’ç”Ÿæˆã—ã¾ã™ã€‚ã“ã®ç§˜å¯†éµã‚‚æ§ãˆã¦ãŠãã¾ã™ã€‚
ã“ã‚Œã‚‰ã®æƒ…å ±ã¯ã€[.github/workflows](#githubworkflows)ã®`sync-author-article.yml`ã«ã‚ã‚‹GitHub Appsã‚’ä½¿ã£ãŸãƒˆãƒ¼ã‚¯ãƒ³ã®ç™ºè¡Œå‡¦ç†ã§ä½¿ã„ã¾ã™ã€‚

```yml
- uses: actions/create-github-app-token@v2
  id: app-token
  with:
    app-id: ${{ secrets.AMBR_ZENN_GITHUB_APP_ID }} # App ID
    private-key: ${{ secrets.AMBR_ZENN_GITHUB_APP_PRIVATE_KEY }} # Private Key
    owner: ${{ steps.fetch-author.outputs.author }}
    repositories: "${{ steps.lookup-author-repo.outputs.author_repo }}"
```

GitHub Appsã ã‘ç”¨æ„ã—ã¦ã‚‚ã€ã¾ã åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚
ãªã®ã§ã€åŸ·ç­†è€…ã«å¯¾ã—ã¦ç”¨æ„ã—ãŸGitHub Appsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

GitHub Appsã®è©³ç´°ãƒšãƒ¼ã‚¸ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«`Public page`ãŒã‚ã‚‹ã®ã§ã€ãã“ã®ãƒšãƒ¼ã‚¸ã‚’åŸ·ç­†è€…ã«æ•™ãˆã¦ã€Zennã®ãƒªãƒã‚¸ãƒˆãƒªã«å¯¾ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚

:::message
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‚‚ã‚‰ã†Zennã®ãƒªãƒã‚¸ãƒˆãƒªã¯ä»¥ä¸‹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ãŒå‰æã§ã™ã€‚
https://zenn.dev/zenn/articles/install-zenn-cli
https://zenn.dev/zenn/articles/connect-to-github
:::

![](/images/1b7cfd04e9af32/github-apps-public-page.png)

### è¨˜äº‹ç®¡ç†ãƒªãƒã‚¸ãƒˆãƒª

ambrã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¨ãªã£ã¦ã„ã¾ã™ã€‚

```sh
.
â”œâ”€â”€ .github
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE
â”‚   â”‚   â”œâ”€â”€ new-article.md
â”‚   â”‚   â”œâ”€â”€ parent-issue.md
â”‚   â”‚   â””â”€â”€ publish.md
â”‚   â”œâ”€â”€ pull_request_template.md
â”‚   â””â”€â”€ workflows
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ sync-author-article.yml
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .markdownlint-cli2.jsonc
â”œâ”€â”€ .textlintignore
â”œâ”€â”€ .textlintrc.yml
â”œâ”€â”€ article_template.md
â”œâ”€â”€ articles/
â”œâ”€â”€ cli/
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ authors.yml
â”‚   â””â”€â”€ contents.yml
â”œâ”€â”€ cspell-ignore-words.txt
â”œâ”€â”€ cspell.yml
â”œâ”€â”€ docs
â”‚   â””â”€â”€ images
â”œâ”€â”€ images/
â”œâ”€â”€ node_modules
â”œâ”€â”€ package.json
â”œâ”€â”€ package-lock.json
â”œâ”€â”€ README.md
â”œâ”€â”€ renovate.json
â”œâ”€â”€ scripts
â”‚   â”œâ”€â”€ copy-articles-to-author-repo.sh
â”‚   â””â”€â”€ lint.sh
â””â”€â”€ Taskfile.yml
```

ãã‚Œãã‚ŒãŒã©ã‚“ãªã“ã¨ã‚’æ‹…å½“ã—ã¦ã„ã‚‹ã‹ã‚’è»½ãè§£èª¬ã—ã¦ã„ãã¾ã™ã€‚

#### articles, images

```sh
â”œâ”€â”€ articles/
â”œâ”€â”€ images/
```

è¨˜äº‹ã¨è¨˜äº‹ä¸­ã§ä½¿ã†ç”»åƒã‚’ç®¡ç†ã™ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã™ã€‚

è¨˜äº‹ã¯è¨˜äº‹ã”ã¨ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã‚ˆã†ãªå½¢ã«ãªã£ã¦ãŠã‚Šã€

```sh
â”œâ”€â”€ articles
â”‚   â””â”€â”€ xxxxxxxx.md
â”‚   â””â”€â”€ yyyyyyyy.md
```

ç”»åƒã¯è¨˜äº‹ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’åˆ‡ã‚‹å½¢ã§ç”»åƒã‚’æ ¼ç´ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã€

```sh
â”œâ”€â”€ images
â”‚   â””â”€â”€ xxxxxxxx
â”‚       â””â”€â”€ some-image.png
â”‚   â””â”€â”€ yyyyyyyy
â”‚       â””â”€â”€ some-image.png
```

è¨˜äº‹æœ¬æ–‡ä¸­ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç”»åƒã‚’åŸ‹ã‚è¾¼ã‚€ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```md:xxxxxxxx.md
![](/images/xxxxxxxx/some-image.png)
```

#### .github/ISSUE_TEMPLATE

```sh
â”œâ”€â”€ .github
â”‚   â”œâ”€â”€ ISSUE_TEMPLATE
â”‚   â”‚   â”œâ”€â”€ new-article.md
â”‚   â”‚   â”œâ”€â”€ parent-issue.md
â”‚   â”‚   â””â”€â”€ publish.md
```

ambrã§ã¯è¨˜äº‹ã®é€²æ—ç®¡ç†ã‚’GitHub Issuesã¨GitHub Projectsã‚’ä½¿ã£ã¦ãŠã‚Šã€`.github/ISSUE_TEMPLATE`ã§ã¯è¨˜äº‹åŸ·ç­†ã«é–¢ã™ã‚‹ã‚¤ã‚·ãƒ¥ãƒ¼ã‚’ç°¡å˜ã«ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

:::details  .github/ISSUE_TEMPLATE/new-article.md

æ–°ã—ãè¨˜äº‹ã‚’åŸ·ç­†ã™ã‚‹éš›ã«ç”¨æ„ã™ã‚‹ã‚¤ã‚·ãƒ¥ãƒ¼ã®ä¾‹ã§ã™ã€‚

```md:.github/ISSUE_TEMPLATE/new-article.md
---
name: è¨˜äº‹åŸ·ç­†
about: æ–°ã—ãè¨˜äº‹ã‚’åŸ·ç­†ã™ã‚‹
title: "ã€è¨˜äº‹åŸ·ç­†ã€‘è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«"
---

## æ¦‚è¦

-

## æŠ•ç¨¿ç›®æ¨™æ™‚æœŸ

-

## æŠ€è¡“

-

## ãã®ä»–

-

```

:::

ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”¨æ„ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ã«Issueä½œæˆæ™‚ã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒé¸æŠã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

![](/images/1b7cfd04e9af32/create-issue.png)

#### .github/workflows

```sh
â”œâ”€â”€ .github
â”‚   â””â”€â”€ workflows
â”‚       â”œâ”€â”€ ci.yml
â”‚       â””â”€â”€ sync-author-article.yml
```

GitHub Actionã®Workflowã¯2ã¤ã‚ã‚Šã€1ã¤ãŒ[è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«](#è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«)ã¨è¨˜äº‹æ–‡æ›¸ã®lintã‚’è¡Œã†`ci.yml`ã¨ã€PRãŒãƒãƒ¼ã‚¸ã•ã‚ŒãŸå¾Œã«åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«åæ˜ PRã‚’ä½œæˆã™ã‚‹`sync-author-article.yml`ãŒã‚ã‚Šã¾ã™ã€‚

:::details .github/workflows/ci.yml

PRã‚ªãƒ¼ãƒ—ãƒ³æ™‚ã¨PRã«æ–°ã—ã„ã‚³ãƒŸãƒƒãƒˆãŒãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ãŸã³ã«å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯ã€è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŸ·ç­†ã—ãŸè¨˜äº‹ã®textlintã€markdownlintã€cspell lintã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

```yml:.github/workflows/ci.yml
name: CI

on:
  pull_request:
    types:
      - opened
      - synchronize

defaults:
  run:
    shell: bash

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  ci:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6

      - uses: actions/setup-node@v6
        with:
          node-version-file: package.json
          cache: npm
          cache-dependency-path: package-lock.json

      - uses: arduino/setup-task@v2
        with:
          version: 3.x
          repo-token: ${{ secrets.GITHUB_TOKEN }}

      - run: npm ci

      - run: npm audit --audit-level moderate

      - name: Get cache key
        id: get-cache-key
        run: |
          echo "cache_key=${{ runner.os }}-cli-${{ hashFiles('cli/**') }}" >> "$GITHUB_OUTPUT"

      - name: Restore cached cli binary
        id: cache-cli-binary-restore
        uses: actions/cache/restore@v4
        with:
          key: ${{ steps.get-cache-key.outputs.cache_key }}
          path: ./cli/main

      - uses: actions/setup-go@v6
        if: ${{ steps.cache-cli-binary-restore.outputs.cache-hit != 'true' }}
        with:
          go-version-file: ./cli/go.mod
          cache-dependency-path: ./cli/go.sum

      - name: Build cli when cache missed
        if: ${{ steps.cache-cli-binary-restore.outputs.cache-hit != 'true' }}
        run: task cli:build

      - name: Save cli binary to cache
        if: ${{ steps.cache-cli-binary-restore.outputs.cache-hit != 'true' }}
        uses: actions/cache/save@v4
        with:
          key: ${{ steps.get-cache-key.outputs.cache_key }}
          path: ./cli/main

      - name: Validate configs
        run: |
          task cli:run-bin -- validate

      - name: Run lint
        id: lint
        run: ./scripts/lint.sh ${{ github.event.pull_request.user.login }}

      - name: Report
        uses: marocchino/sticky-pull-request-comment@v2
        with:
          header: "Lint Report"
          message: |
            ## textlint results

            ${{ steps.lint.outputs.textlint_result || 'No errors.' }}

            ## markdownlint results

            ${{ steps.lint.outputs.mdlint_result || 'No errors.' }}

            ## cspell results

            ${{ steps.lint.outputs.splint_result || 'No errors.' }}

      - name: Fail when markdownlint or cspell lint has errors
        run: |
          if [ "$MDLINT_RESULT" != "" ] || [ "$SPLINT_RESULT" != "" ]; then
            echo "::error::markdownlint or cspell lint failed. Please fix the errors."
            exit 1
          fi
        env:
          MDLINT_RESULT: ${{ steps.lint.outputs.mdlint_result }}
          SPLINT_RESULT: ${{ steps.lint.outputs.splint_result }}
```

lintçµæœã¯`marocchino/sticky-pull-request-comment`ã‚’ä½¿ã£ã¦PRã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ãå‡ºã™ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

![](/images/1b7cfd04e9af32/pr-comment.png)

ã¾ãŸã€ã¡ã‚‡ã£ã¨ã—ãŸæœ€é©åŒ–ã¨ã—ã¦`actions/setup-go`ã®æ™‚é–“ãŒæ„å¤–ã¨ã‹ã‹ã‚‹ã®ã§ã€ã“ã‚Œã‚’ç¯€ç´„ã™ã‚‹ãŸã‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸãƒã‚¤ãƒŠãƒªãŒè¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸã¨ãã®ã¿`actions/setup-go`ã‚’ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®Ÿè¡Œæ™‚é–“ã¯ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã„ã¨ãã¯1åˆ†åŠãã‚‰ã„ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚‹ã¨ã50ç§’ä»¥å†…ã«å®Œäº†ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

:::

:::details .github/workflows/sync-author-article.yml

PRãƒãƒ¼ã‚¸æ™‚ã«åŠ ãˆã¦ã€åŒæœŸã«å¤±æ•—ã™ã‚‹å¯èƒ½æ€§ã‚‚ã‚ã‚‹ã®ã§åŸ·ç­†è€…ã‚’å…¥åŠ›ã—ã¦ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ã¯ã€åŸ·ç­†è€…ã®GitHubã®åå‰ã‚’ä½¿ã£ã¦è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰è¨˜äº‹ã¨å€‹äººãƒªãƒã‚¸ãƒˆãƒªã‚’ç‰¹å®šã—ã€åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã€è¨˜äº‹ã¨ç”»åƒã®å¤‰æ›´ã‚’å–ã‚Šè¾¼ã¿ã€å·®åˆ†ãŒã‚ã£ãŸã‚‰åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```yml:.github/workflows/sync-author-article.yml
name: Authorã®ãƒªãƒã‚¸ãƒˆãƒªã«pushã™ã‚‹

on:
  pull_request:
    types:
      - closed
    paths:
      - "articles/**"
      - "images/**"
  workflow_dispatch:
    inputs:
      author_github_name:
        description: "Author's GitHub Name"
        type: string
        required: true

defaults:
  run:
    shell: bash

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  fetch-author:
    if: ${{ github.event.pull_request.merged == true || github.event_name == 'workflow_dispatch' }}
    name: è¨˜äº‹åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’ä½œæˆã™ã‚‹
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - uses: actions/checkout@v6

      - name: Fetch Author From Merged PR
        id: fetch-author
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          if [ "${{ github.event_name }}" = "workflow_dispatch" ]; then
            echo "author=${{ github.event.inputs.author_github_name }}" >> $GITHUB_OUTPUT
          else
            PR_NUM=${{ github.event.pull_request.number }}
            echo "author=`gh pr view ${PR_NUM} --json author -q .author.login`" >> $GITHUB_OUTPUT
          fi

      - name: Lookup Author's Zenn Repository
        id: lookup-author-repo
        env:
          AUTHOR_NAME: ${{ steps.fetch-author.outputs.author }}
        run: |
          author_repo=$(yq ".authors[] | select(.github_name == \"${AUTHOR_NAME}\") | .zenn_repo" config/authors.yml)
          if [ -z "$author_repo" ]; then
            echo "Error: github_name \"${AUTHOR_NAME}\" not found in author.yml or the repository is empty" >&2
            exit 1
          fi
          echo "author_repo=${author_repo}" >> $GITHUB_OUTPUT

      - uses: actions/create-github-app-token@v2
        id: app-token
        with:
          app-id: ${{ secrets.AMBR_ZENN_GITHUB_APP_ID }}
          private-key: ${{ secrets.AMBR_ZENN_GITHUB_APP_PRIVATE_KEY }}
          owner: ${{ steps.fetch-author.outputs.author }}
          repositories: "${{ steps.lookup-author-repo.outputs.author_repo }}"

      - name: Check Author's Repository Status
        id: check-author-repo-status
        env:
          AUTHOR: ${{ steps.fetch-author.outputs.author }}
          AUTHOR_REPO: ${{ steps.lookup-author-repo.outputs.author_repo }}
          GH_TOKEN: ${{ steps.app-token.outputs.token}}
        run: |
          gh auth status
          echo "author_repo_base_branch=$(gh repo view "$AUTHOR/$AUTHOR_REPO" --json defaultBranchRef -q .defaultBranchRef.name)" >> $GITHUB_OUTPUT
          git clone https://x-access-token:"$GH_TOKEN"@github.com/"$AUTHOR"/"$AUTHOR_REPO".git target-repo

      - name: Copy author's article to author's repository
        env:
          AUTHOR: ${{ steps.fetch-author.outputs.author }}
        run: ./scripts/copy-articles-to-author-repo.sh $AUTHOR

      - name: Check difference
        id: check_diff
        working-directory: target-repo
        run: |
          if git status --porcelain | grep .; then
            echo "diff_found=true" >> $GITHUB_OUTPUT
          else
            echo "diff_found=false" >> $GITHUB_OUTPUT
          fi

      - name: Create Pull Request
        if: ${{ steps.check_diff.outputs.diff_found == 'true' }}
        env:
          AUTHOR: ${{ steps.fetch-author.outputs.author }}
          AUTHOR_REPO: ${{ steps.lookup-author-repo.outputs.author_repo }}
          AUTHOR_REPO_BASE_BRANCH: ${{ steps.check-author-repo-status.outputs.author_repo_base_branch }}
          GH_TOKEN: ${{ steps.app-token.outputs.token}}
          BRANCH_NAME: feat/update-articles-from-ambr-inc
        run: |
          cd target-repo
          git config user.name "github-actions[bot]"
          git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git checkout -b ${{ env.BRANCH_NAME }}
          git add .
          git commit -m "feat: Update articles"
          git push -f https://x-access-token:"$GH_TOKEN"@github.com/"$AUTHOR"/"$AUTHOR_REPO".git  ${{ env.BRANCH_NAME }}

          if gh pr list --head ${{ env.BRANCH_NAME }} -s open --json number --jq '.[].number' | grep -q .; then
            echo "Opend PR already exists. Skip creating PR."
          else
            gh pr create \
              --repo "$AUTHOR"/"$AUTHOR_REPO" \
              --head  ${{ env.BRANCH_NAME }} \
              --base "$AUTHOR_REPO_BASE_BRANCH" \
              --title "feat: Update articles from ambr-inc" \
              --body "This PR updates some articles from ambr inc. Check the changes and merge if everything is fine."
          fi
```

`on.pull_request.types`ã«`closed`ã‚’æŒ‡å®šã ã‘ã ã¨PRã‚¯ãƒ­ãƒ¼ã‚ºã•ã‚ŒãŸã¨ãã‚‚ãƒˆãƒªã‚¬ãƒ¼ã—ã¦ã—ã¾ã†ã®ã§ã€ã‚¸ãƒ§ãƒ–å®Ÿè¡Œæ¡ä»¶ã«ãƒãƒ¼ã‚¸ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèªã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```yml
jobs:
  fetch-author:
    if: ${{ github.event.pull_request.merged == true || github.event_name == 'workflow_dispatch' }}
    name: è¨˜äº‹åŸ·ç­†è€…ã®å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«PRã‚’ä½œæˆã™ã‚‹
```

ç”¨æ„ã—ãŸGitHub Appsã‚’äº‹å‰ã«åŸ·ç­†è€…ã«å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ã§ã€GitHub Appsã‚’ä½¿ã£ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç™ºè¡Œã—ã€ãã®ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦å€‹äººãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦ã„ã¾ã™ã€‚

å½“åˆã¡ã‚ƒã‚“ã¨æ¤œè¨¼ã—ãŸã‹ã‚’è¦šãˆã¦ã„ã¾ã›ã‚“ãŒã€`git clone`ã‚’ä½¿ã£ã¦ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦ã„ã‚‹ã¨ã“ã‚ã¯ã€`actions/checkout`ã‚’ä½¿ã£ã¦`repository`ã€`path`ã€`token`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã‚‚ã§ããã†ã§ã™ã€‚

```yml
- uses: actions/create-github-app-token@v2
  id: app-token
  with:
    app-id: ${{ secrets.AMBR_ZENN_GITHUB_APP_ID }}
    private-key: ${{ secrets.AMBR_ZENN_GITHUB_APP_PRIVATE_KEY }}
    owner: ${{ steps.fetch-author.outputs.author }}
    repositories: "${{ steps.lookup-author-repo.outputs.author_repo }}"

- name: Check Author's Repository Status
  id: check-author-repo-status
  env:
    AUTHOR: ${{ steps.fetch-author.outputs.author }}
    AUTHOR_REPO: ${{ steps.lookup-author-repo.outputs.author_repo }}
    GH_TOKEN: ${{ steps.app-token.outputs.token}}
  run: |
    gh auth status
    echo "author_repo_base_branch=$(gh repo view "$AUTHOR/$AUTHOR_REPO" --json defaultBranchRef -q .defaultBranchRef.name)" >> $GITHUB_OUTPUT
    git clone https://x-access-token:"$GH_TOKEN"@github.com/"$AUTHOR"/"$AUTHOR_REPO".git target-repo
```

ã“ã‚“ãªæ„Ÿã˜ã§PRãŒä½œæˆã•ã‚Œã¾ã™ã€‚

![](/images/1b7cfd04e9af32/created-pr.png)

:::

#### Lintè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

åŸ·ç­†ã•ã‚ŒãŸè¨˜äº‹ã¯ä»¥ä¸‹ã®3ã¤ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦Lintã—ã¦ã„ã¾ã™ã€‚

- markdownlint
    - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®æ›¸å¼ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹
- textlint
    - æ–‡æ›¸æ ¡æ­£
- cspell
    - ã‚¹ãƒšãƒ«ãƒŸã‚¹ã‚’æŒ‡æ‘˜ã™ã‚‹

CIã§ã“ã‚Œã‚‰3ã¤ã®Linterã‚’å‹•ã‹ã—ã¦ã„ã¾ã™ãŒã€ãƒãƒ¼ã‚¸ã™ã‚‹æ¡ä»¶ã¨ã—ã¦å…¨ã¦ã‚’ã‚¯ãƒªã‚¢ã•ã›ã‚‹å¿…è¦ã¯ãªãã€markdownlintã®ã¿ã‚’ã‚¯ãƒªã‚¢ã™ã‚Œã°ã„ã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚
textlintã¨cspellã®Lintçµæœã¯ã‚ãã¾ã§å‚è€ƒç¨‹åº¦ã«ã•ã›ã¦ä¿®æ­£ã¯åŸ·ç­†è€…ã«ä»»ã›ã‚‹æ–¹é‡ã«ã™ã‚‹ã“ã¨ã§ã€èª­ã¿å‘³ãŒæãªã‚ã‚Œã‚‹ã“ã¨ãŒãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

:::details markdownlint

Zennã§ã¯URLã ã‘ã®è¡Œã¯[ãƒªãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰](https://zenn.dev/zenn/articles/markdown-guide#%E3%83%AA%E3%83%B3%E3%82%AF%E3%82%AB%E3%83%BC%E3%83%89)ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ãŠã‚Šã€`no-bare-urls`ã‚’`false`ã«ã™ã‚‹ã“ã¨ã§æ¤œçŸ¥ã•ã‚Œãªã„ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
ãã®ä»–ã«ã‚‚è¨˜äº‹ã‚’æ›¸ãä¸Šã§ã¯ãƒã‚¤ã‚ºã¨ãªã‚Šå¾—ã‚‹ã‚ˆã†ãªã‚‚ã®ç„¡åŠ¹åŒ–ã—ã¦ã„ã¾ã™ã€‚

```yml:.markdownlint-cli2.jsonc
{
  "config": {
    "line-length": false,
    "no-duplicate-heading": {
      "siblings_only": true
    },
    "no-bare-urls": false,
    "no-inline-html": false,
    "commands-show-output": false,
    "single-h1": false,
    "no-alt-text": false,
    "no-hard-tabs": false,
    "ul-indent": {
      "indent": 4
    },
    "link-fragments": false,
    "no-space-in-emphasis": false
  },
  "ignores": [".github", ".idea", "node_modules"]
}
```

:::

:::details textlint

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚

- `textlint-filter-rule-allowlist`
- `textlint-filter-rule-comments`
- `textlint-rule-aws-service-name`
- `textlint-rule-ja-hiragana-daimeishi`
- `textlint-rule-no-mixed-zenkaku-and-hankaku-alphabet`
- `textlint-rule-preset-ja-technical-writing`

```yml:.textlintrc.yml
plugins:
filters:
  comments: true
  allowlist:
    allow:
rules:
  aws-service-name: true
  ja-hiragana-daimeishi: true
  no-mixed-zenkaku-and-hankaku-alphabet: true
  preset-ja-technical-writing:
    sentence-length:
      max: 1000
    ja-no-mixed-period:
      allowPeriodMarks:
        - "ã€"
        - "ï¼š"
        - ":"
        - "."
        - "m(_ _)m"
    ja-no-successive-word:
      allow:
        - "â€¦"
    no-doubled-joshi: false
    no-mix-dearu-desumasu: false
    no-exclamation-question-mark: false
    ja-no-weak-phrase: false
    no-double-negative-ja: false
    no-hankaku-kana: false
    max-kanji-continuous-len: false
```

:::

:::details cspell

ã‚¿ã‚¤ãƒã‚’æŒ‡æ‘˜ã—ã¦ãã‚Œã‚‹Linterã§ã™ã€‚
ãŸã ã€äººåã‚„ä¼šç¤¾åãªã©ã§å¼•ã£ã‹ã‹ã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã®ã§ã€ãã†ã„ã†ã‚‚ã®ã¯`cspell-ignore-words.txt`ã«å…¥ã‚Œã¦ãŠãã“ã¨ã§ç„¡è¦–ã•ã›ã¾ã™ã€‚

```yml:cspell.yml
$schema: https://raw.githubusercontent.com/streetsidesoftware/cspell/main/cspell.schema.json
version: "0.2"
allowCompoundWords: true
dictionaryDefinitions:
  - name: cspell-ignore-words
    path: "./cspell-ignore-words.txt"
    addWords: true
dictionaries:
  - cspell-ignore-words
ignorePaths:
  - /cspell.yml
  - /cspell-ignore-words.txt
  - /node_modules
  - /package.json
  - /package-lock.json
```

:::

#### cli

```sh
â”œâ”€â”€ cli/
```

[cobra](https://github.com/spf13/cobra)ã‚’ä½¿ã£ã¦ä½œæˆã—ãŸCLIã§ã™ã€‚
[è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«](#è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«)ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã€åŸ·ç­†è€…ãŒåŸ·ç­†ã—ãŸè¨˜äº‹ä¸€è¦§ã®å–å¾—ã‚„ã€ã¾ã å…¬é–‹ã—ã¦ã„ãªã„è¨˜äº‹ã®ä¸€è¦§å–å¾—ãªã©ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¼ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚

#### è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

```sh
â”œâ”€â”€ config
â”‚   â”œâ”€â”€ authors.yml
â”‚   â””â”€â”€ contents.yml
```

åŸ·ç­†è€…ã®Zennã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«(`authors.yml`)ã¨ã€è¨˜äº‹ã‚’èª°ãŒæ›¸ã„ãŸã‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«(`contents.yml`)ã®2ã¤ãŒã‚ã‚Šã¾ã™ã€‚

:::details config/authors.yml

```yml:config/authors.yml
# è¨˜äº‹åŸ·ç­†è€…ã®Zennã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã®è¨­å®šã§ã™
# ã“ã“ã«è¨˜è¼‰ã•ã‚Œãªã‹ã£ãŸå ´åˆã¯æ­£ã—ãé€£æºã•ã‚Œã¾ã›ã‚“
authors:
  - github_name: "github_name" # GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å
    zenn_repo: "zenn_repo" # Zennã¨é€£æºã—ãŸãƒªãƒã‚¸ãƒˆãƒªã®åå‰
```

:::

:::details config/contents.yml

```yml:config/contents.yml
# è¨˜äº‹ã‚’èª°ãŒæ›¸ã„ãŸã‹ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™
# ã“ã“ã«æœªè¨˜è¼‰ã®è¨˜äº‹ã¯å€‹äººãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã›ã‚“ã€‚
contents:
  - github_name: "github_name" # GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å
    blog_ids: # è¨˜äº‹ã®ãƒ•ã‚¡ã‚¤ãƒ«å(æ‹¡å¼µå­ã‚’é™¤ã„ãŸã‚‚ã®)ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„
      - "blog_id_1"
      - "blog_id_2"
      - "blog_id_3"
```

:::

#### Taskfile.yml

https://taskfile.dev/

ã‚³ãƒãƒ³ãƒ‰ã‚’è©³ã—ãçŸ¥ã‚‰ãªãã¦ã‚‚ç°¡å˜ã«å©ã‘ã‚‹ã‚ˆã†ã«`Taskfile.yml`ã‚’ç”¨æ„ã—ã¦ã„ã¾ã™ã€‚

:::details Taskfile.yml

`cli/`ã®ã»ã†ã«ã‚‚`Taskfile.yml`ã‚’ç”¨æ„ã—ã¦ãŠã‚Šã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã‹ã‚‰ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«`include`ã—ã¦ã„ã¾ã™ã€‚

```yml:Taskfile.yml
version: "3"

includes:
  cli:
    taskfile: cli/Taskfile.yml
    dir: cli

vars:
  SELECT_ARTICLE_CMD: |
    {{- if eq OS "windows" -}}
      cmd /c "for %f in (articles/*.md) do @echo articles/%~nxf" | fzf
    {{- else -}}
      find ./articles -type f -regex '.*\.md' | fzf
    {{- end -}}

tasks:
  default:
    desc: ä½¿ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã‚’ä¸€è¦§è¡¨ç¤º
    cmds:
      - task --list --sort none
    silent: true

  new-article:
    desc: æ–°ã—ã„è¨˜äº‹ã‚’ä½œæˆ
    cmd: |
      ARTICLE_PATH=$(npx zenn new:article --publication-name 'ambr_inc' --machine-readable {{.CLI_ARGS}})
      cat article_template.md >> "$ARTICLE_PATH"
      echo "Article created: $ARTICLE_PATH"
    silent: true

  list-articles:
    desc: è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º
    cmds:
      - npx zenn list:articles {{.CLI_ARGS}}
    silent: true

  preview:
    desc: æŠ•ç¨¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    cmds:
      - npx zenn preview {{.CLI_ARGS}}

  ci-lint:
    desc: Lint all(ci settings)
    cmds:
      - task ci-textlint -- {{.TARGET}} || true
      - task ci-mdlint -- {{.TARGET}} || true
      - task ci-splint -- {{.TARGET}} || true
    vars:
      TARGET:
        sh: "{{.SELECT_ARTICLE_CMD}}"

  textlint:
    internal: true
    desc: textlint
    cmds:
      - npx textlint {{.CLI_ARGS}}
    silent: true

  mdlint:
    internal: true
    desc: markdownlint
    cmds:
      - npx markdownlint-cli2 {{.CLI_ARGS}}
    silent: true

  splint:
    internal: true
    desc: cspell lint
    cmds:
      - npx cspell lint --no-progress --show-suggestions --show-context {{.CLI_ARGS}}
    silent: true

  ci-textlint:
    desc: textlint for CI
    cmds:
      - task: textlint
        vars:
          CLI_ARGS: "--no-color -c .textlintrc.yml {{.CLI_ARGS}}"
    silent: true

  ci-mdlint:
    desc: markdownlint for CI
    cmds:
      - task: mdlint
        vars:
          CLI_ARGS: "--config .markdownlint-cli2.jsonc {{.CLI_ARGS}}"
    silent: true

  ci-splint:
    desc: cspell lint for CI
    cmds:
      - task: splint
        vars:
          CLI_ARGS: "--no-color -c cspell.yml {{.CLI_ARGS}}"
    silent: true
```

`default`ã‚¿ã‚¹ã‚¯ã«ã¯ä½¿ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ä¸€è¦§ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯`task`ã¨æ‰“ã¤ã ã‘ã§ã©ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ãŒå®Ÿè¡Œå¯èƒ½ã‹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```sh
â¯ task
task: Available tasks for this project:
* default:              ä½¿ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã‚’ä¸€è¦§è¡¨ç¤º
* new-article:          æ–°ã—ã„è¨˜äº‹ã‚’ä½œæˆ
* list-articles:        è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º
* preview:              æŠ•ç¨¿ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
* ci-lint:              Lint all(ci settings)
* ci-textlint:          textlint for CI
* ci-mdlint:            markdownlint for CI
* ci-splint:            cspell lint for CI
* cli:default:          ä½¿ç”¨å¯èƒ½ãªã‚¿ã‚¹ã‚¯ã‚’ä¸€è¦§è¡¨ç¤º      (aliases: cli)
* cli:mod:              go mod tidy
* cli:run:              CLIã‚’ãã®ã¾ã¾å®Ÿè¡Œ
* cli:run-bin:          ãƒ“ãƒ«ãƒ‰ã—ãŸCLIã‚’å®Ÿè¡Œ
* cli:build:            ãƒ“ãƒ«ãƒ‰
```

ã¾ãŸã€å„ã‚¿ã‚¹ã‚¯ã«ã‚ã‚‹`{{.CLI_ARGS}}`ã¯`task`ã‚’ä½¿ã£ã¦è¿½åŠ ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ãŸã„ã¨ãã«æœ‰ç”¨ãªã‚‚ã®ã§ã€

ä¾‹ãˆã°ã“ã®ã‚ˆã†ãªã‚¿ã‚¹ã‚¯ã«å¯¾ã—ã¦ã€

```yml
list-articles:
  desc: è¨˜äº‹ä¸€è¦§ã‚’è¡¨ç¤º
  cmds:
    - npx zenn list:articles {{.CLI_ARGS}}
  silent: true
```

å®Ÿè¡Œã™ã‚‹ã‚¿ã‚¹ã‚¯åã®ã‚ã¨ã«`--`ã‚’è¨­ã‘ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¸¡ã—ã¦å®Ÿè¡Œã™ã‚‹ã¨ã€

```sh
task list-articles -- -h
```

`CLI_ARGS`ãŒæ¸¡ã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ç½®ãæ›ãˆã‚‰ã‚Œã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

```sh
npx zenn list:articles -h
```

https://taskfile.dev/docs/guide#forwarding-cli-arguments-to-commands

:::

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã®é‹ç”¨

ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ãŸå¾Œã¯ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †ã‚„è¨˜äº‹ã‚’æ›¸ãä¸Šã§ã®æ³¨æ„ç‚¹ãªã©ã‚’READMEã«ã¾ã¨ã‚ã€åŸ·ç­†è€…ã«å‘¨çŸ¥ãƒ»ã‚µãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚

## ãŠã‚ã‚Šã«

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å½“åˆã®åŸ·ç­†ç’°å¢ƒã§ã¯Linterã®è¨­å®šãŒå³ã—ã™ãã‚‹ã“ã¨ã‚‚ã‚ã‚Šã€èª¤æ¤œçŸ¥ã‚„ä¿®æ­£ã—ãªãã¦ã‚‚ã„ã„ã‚‚ã®ã¾ã§å‡ºã¦ããŸã‚Šã—ã¦ã„ã¾ã—ãŸã€‚æŠ€è¡“ãƒ–ãƒ­ã‚°é‹å–¶ãƒãƒ¼ãƒ ã‚„åŸ·ç­†è€…ã‹ã‚‰æ”¹å–„æ¡ˆã‚’è©±ã—åˆã†ã“ã¨ã§ã€ä»Šã®ã‚ˆã†ãªä¸€éƒ¨å¿…é ˆã ã‘ã‚Œã©ä»–ã¯ä»»æ„ã§ä¿®æ­£ã¨ã„ã†å½¢ã«è½ã¡ç€ã„ã¦ã„ã¾ã™ã€‚

ãƒ†ãƒƒã‚¯ãƒ–ãƒ­ã‚°ã®åŸ·ç­†ç’°å¢ƒã‚‚ã€ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆé–‹ç™ºã¨åŒã˜ã‚ˆã†ã«ç¶™ç¶šçš„ã«æ”¹å–„ã—ã¦ã„ãã‚‚ã®ã ã¨å®Ÿæ„Ÿã—ãŸ1å¹´ã§ã—ãŸã€‚
ambrã§ã¯ä»Šå¾Œã‚‚æŠ€è¡“ç™ºä¿¡ã‚’ç¶šã‘ã¦ã„ãã¾ã™ã®ã§ã€ã‚ˆã‚ã—ã‘ã‚Œã°ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ãŸã ã‘ã‚‹ã¨åŠ±ã¿ã«ãªã‚Šã¾ã™ã€‚
